<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Batch CIK PDFs</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:24px;max-width:900px}
    h1{font-size:20px;margin:0 0 12px}
    label{display:block;font-weight:600;margin-top:14px}
    textarea{width:100%;height:140px;padding:10px;font-size:14px;box-sizing:border-box}
    button{padding:12px 16px;font-size:14px;cursor:pointer}
    .log{margin-top:12px;background:#fafafa;border:1px solid #eee;padding:10px;font-family:ui-monospace,Menlo,Consolas,monospace;white-space:pre-wrap}
    .ok{color:#196a2a}.err{color:#a40000}
  </style>
</head>
<body>
  <h1>Form ID → PDFs (Batch)</h1>
  <p>Source HTML, EIN seed, paper format are fixed server-side.</p>

  <label>Funds CSV (one per line): <small>Format: <code>Fund,EIN</code></small></label>
  <textarea id="rows" placeholder="Defense VII, a Series of E1 VC, LLC,111111111&#10;Defense VIII, a Series of E1 VC, LLC,222222222"></textarea>

  <button id="go">Generate PDFs</button>
  <div class="log" id="log"></div>

<script>
const API = "https://YOUR-PROJECT.vercel.app/api/cik-pdf"; // <- your Vercel URL

const slug = s => s.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"");
const outName = fund => `${slug(fund)}cik_fornotary.pdf`;
const $ = id => document.getElementById(id);
const say = (m,cls="") => { const d = document.createElement("div"); if(cls) d.className = cls; d.textContent = m; $("log").appendChild(d); };

function parseRows(txt){
  const rows = [];
  for (const line of txt.split(/\r?\n/)) {
    const s = line.trim();
    if (!s) continue;
    const parts = s.split(",").map(x=>x.trim());
    if (parts.length < 2) continue;
    if (rows.length===0 && /fund/i.test(parts[0]) && /ein/i.test(parts[1])) continue; // header
    rows.push({ fund: parts.slice(0,-1).join(", "), ein: parts.at(-1) });
  }
  return rows;
}

async function genOne({fund, ein}, i, n){
  say(`[${i}/${n}] ${fund} …`);
  const r = await fetch(`${API}?fund=${encodeURIComponent(fund)}&ein=${encodeURIComponent(ein)}`);
  if (!r.ok) throw new Error(await r.text());
  const blob = await r.blob();
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = outName(fund);
  document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(a.href);
  say(`OK → ${outName(fund)}`, "ok");
}

$("go").addEventListener("click", async () => {
  $("log").textContent = "";
  const rows = parseRows($("rows").value);
  if (!rows.length) { say("Enter at least one line: Fund,EIN","err"); return; }
  for (let i=1;i<=rows.length;i++){
    try { await genOne(rows[i-1], i, rows.length); }
    catch (e) { say(`ERROR: ${e.message}`, "err"); }
  }
  say("Done.");
});
</script>
</body>
</html>
